<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NetBoxy VPN</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00d4ff;
            --primary-dark: #00a3cc;
            --secondary: #6c5ce7;
            --accent: #ff6b6b;
            --success: #00e676;
            --bg-dark: #0a0e27;
            --bg-card: #151b3d;
            --bg-input: #1a2147;
            --text-primary: #ffffff;
            --text-secondary: #b8c1ec;
            --border: #2d3561;
            --shadow: rgba(0, 212, 255, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(108, 92, 231, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0, 212, 255, 0.1) 0%, transparent 50%);
            overflow-x: hidden;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 0;
            position: relative;
        }

        .logo-container {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .logo {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .logo::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .logo svg {
            width: 40px;
            height: 40px;
            fill: white;
            position: relative;
            z-index: 1;
        }

        .app-title {
            font-size: 2.5em;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -1px;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1em;
            margin-top: 8px;
            font-weight: 400;
        }

        .card {
            background: var(--bg-card);
            border-radius: 24px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: var(--primary);
            box-shadow: 0 20px 60px var(--shadow);
        }

        .lang-selector {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .lang-btn {
            padding: 10px 20px;
            background: var(--bg-input);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Cairo', sans-serif;
            font-size: 0.9em;
            font-weight: 600;
        }

        .lang-btn:active {
            transform: scale(0.95);
        }

        .lang-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-color: transparent;
            box-shadow: 0 5px 15px var(--shadow);
        }

        .input-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.95em;
        }

        .config-input {
            width: 100%;
            padding: 16px;
            background: var(--bg-input);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9em;
            transition: all 0.3s ease;
            resize: vertical;
            min-height: 120px;
        }

        .config-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(0, 212, 255, 0.1);
        }

        .connect-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 16px;
            color: white;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Cairo', sans-serif;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px var(--shadow);
        }

        .connect-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .connect-btn:active {
            transform: scale(0.98);
        }

        .connect-btn.connected {
            background: linear-gradient(135deg, var(--success), #00c853);
        }

        .connect-btn.connecting {
            background: linear-gradient(135deg, #ffa726, #ff9800);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .status-container {
            margin-top: 20px;
            padding: 16px;
            background: var(--bg-input);
            border-radius: 12px;
            border: 2px solid var(--border);
            display: none;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .status-container.show {
            display: block;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .status-item:last-child {
            border-bottom: none;
        }

        .status-label {
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .status-value {
            color: var(--text-primary);
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9em;
        }

        .config-details {
            background: var(--bg-input);
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
            display: none;
            animation: slideIn 0.3s ease-out;
        }

        .config-details.show {
            display: block;
        }

        .detail-item {
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-label {
            color: var(--text-secondary);
            font-size: 0.85em;
            margin-bottom: 4px;
        }

        .detail-value {
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9em;
            word-break: break-all;
        }

        .error-message {
            background: rgba(255, 107, 107, 0.1);
            border: 2px solid var(--accent);
            border-radius: 12px;
            padding: 16px;
            color: var(--accent);
            margin-top: 15px;
            display: none;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .error-message.show {
            display: block;
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        [dir="rtl"] .logo-container {
            flex-direction: row-reverse;
        }

        @media (max-width: 640px) {
            .container {
                padding: 15px;
            }

            .app-title {
                font-size: 2em;
            }

            .card {
                padding: 20px;
            }
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-left: 10px;
            vertical-align: middle;
        }

        [dir="rtl"] .loading-spinner {
            margin-left: 0;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .success-message {
            background: rgba(0, 230, 118, 0.1);
            border: 2px solid var(--success);
            border-radius: 12px;
            padding: 16px;
            color: var(--success);
            margin-top: 15px;
            display: none;
            animation: slideIn 0.3s ease-out;
        }

        .success-message.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <div class="logo">
                    <svg viewBox="0 0 24 24">
                        <path d="M12,2C6.48,2,2,6.48,2,12s4.48,10,10,10s10-4.48,10-10S17.52,2,12,2z M12,20c-4.41,0-8-3.59-8-8s3.59-8,8-8 s8,3.59,8,8S16.41,20,12,20z M7,12l5,5l5-5H7z"/>
                    </svg>
                </div>
            </div>
            <h1 class="app-title">NetBoxy</h1>
            <p class="subtitle" data-i18n="subtitle">VPN الخاص بك للاتصال الآمن</p>
        </div>

        <div class="lang-selector">
            <button class="lang-btn active" onclick="changeLanguage('ar')">العربية</button>
            <button class="lang-btn" onclick="changeLanguage('en')">English</button>
            <button class="lang-btn" onclick="changeLanguage('fr')">Français</button>
            <button class="lang-btn" onclick="changeLanguage('es')">Español</button>
            <button class="lang-btn" onclick="changeLanguage('de')">Deutsch</button>
            <button class="lang-btn" onclick="changeLanguage('tr')">Türkçe</button>
        </div>

        <div class="card">
            <div class="input-group">
                <label for="vlessConfig" data-i18n="configLabel">تكوين VLESS الخاص بك</label>
                <textarea 
                    id="vlessConfig" 
                    class="config-input" 
                    placeholder="vless://..."
                    data-i18n-placeholder="configPlaceholder"
                ></textarea>
            </div>

            <button id="connectBtn" class="connect-btn" onclick="toggleConnection()">
                <span data-i18n="connectBtn">اتصال</span>
            </button>

            <div id="errorMessage" class="error-message"></div>
            <div id="successMessage" class="success-message"></div>

            <div id="configDetails" class="config-details"></div>
        </div>

        <div id="statusContainer" class="status-container">
            <div class="status-item">
                <span class="status-label" data-i18n="statusLabel">الحالة:</span>
                <span id="statusValue" class="status-value">غير متصل</span>
            </div>
            <div class="status-item">
                <span class="status-label" data-i18n="serverLabel">الخادم:</span>
                <span id="serverValue" class="status-value">-</span>
            </div>
            <div class="status-item">
                <span class="status-label" data-i18n="portLabel">المنفذ:</span>
                <span id="portValue" class="status-value">-</span>
            </div>
        </div>

        <div class="footer">
            <p data-i18n="footer">© 2024 NetBoxy - الاتصال الآمن للجميع</p>
        </div>
    </div>

    <script>
        // Multi-language support
        const translations = {
            ar: {
                subtitle: "VPN الخاص بك للاتصال الآمن",
                configLabel: "تكوين VLESS الخاص بك",
                configPlaceholder: "vless://...",
                connectBtn: "اتصال",
                disconnectBtn: "قطع الاتصال",
                connecting: "جاري الاتصال...",
                statusLabel: "الحالة:",
                serverLabel: "الخادم:",
                portLabel: "المنفذ:",
                footer: "© 2024 NetBoxy - الاتصال الآمن للجميع",
                connected: "متصل",
                disconnected: "غير متصل",
                invalidConfig: "تكوين غير صالح! يرجى التحقق من رابط VLESS",
                emptyConfig: "يرجى إدخال تكوين VLESS",
                connectedSuccess: "تم الاتصال بنجاح!",
                disconnectedSuccess: "تم قطع الاتصال"
            },
            en: {
                subtitle: "Your VPN for Secure Connection",
                configLabel: "Your VLESS Configuration",
                configPlaceholder: "vless://...",
                connectBtn: "Connect",
                disconnectBtn: "Disconnect",
                connecting: "Connecting...",
                statusLabel: "Status:",
                serverLabel: "Server:",
                portLabel: "Port:",
                footer: "© 2024 NetBoxy - Secure Connection for Everyone",
                connected: "Connected",
                disconnected: "Disconnected",
                invalidConfig: "Invalid configuration! Please check your VLESS link",
                emptyConfig: "Please enter a VLESS configuration",
                connectedSuccess: "Connected successfully!",
                disconnectedSuccess: "Disconnected"
            },
            fr: {
                subtitle: "Votre VPN pour une connexion sécurisée",
                configLabel: "Votre configuration VLESS",
                configPlaceholder: "vless://...",
                connectBtn: "Connecter",
                disconnectBtn: "Déconnecter",
                connecting: "Connexion...",
                statusLabel: "Statut:",
                serverLabel: "Serveur:",
                portLabel: "Port:",
                footer: "© 2024 NetBoxy - Connexion sécurisée pour tous",
                connected: "Connecté",
                disconnected: "Déconnecté",
                invalidConfig: "Configuration invalide! Veuillez vérifier votre lien VLESS",
                emptyConfig: "Veuillez entrer une configuration VLESS",
                connectedSuccess: "Connecté avec succès!",
                disconnectedSuccess: "Déconnecté"
            },
            es: {
                subtitle: "Tu VPN para conexión segura",
                configLabel: "Tu configuración VLESS",
                configPlaceholder: "vless://...",
                connectBtn: "Conectar",
                disconnectBtn: "Desconectar",
                connecting: "Conectando...",
                statusLabel: "Estado:",
                serverLabel: "Servidor:",
                portLabel: "Puerto:",
                footer: "© 2024 NetBoxy - Conexión segura para todos",
                connected: "Conectado",
                disconnected: "Desconectado",
                invalidConfig: "¡Configuración no válida! Por favor verifica tu enlace VLESS",
                emptyConfig: "Por favor ingresa una configuración VLESS",
                connectedSuccess: "¡Conectado con éxito!",
                disconnectedSuccess: "Desconectado"
            },
            de: {
                subtitle: "Ihr VPN für sichere Verbindung",
                configLabel: "Ihre VLESS-Konfiguration",
                configPlaceholder: "vless://...",
                connectBtn: "Verbinden",
                disconnectBtn: "Trennen",
                connecting: "Verbinde...",
                statusLabel: "Status:",
                serverLabel: "Server:",
                portLabel: "Port:",
                footer: "© 2024 NetBoxy - Sichere Verbindung für alle",
                connected: "Verbunden",
                disconnected: "Getrennt",
                invalidConfig: "Ungültige Konfiguration! Bitte überprüfen Sie Ihren VLESS-Link",
                emptyConfig: "Bitte geben Sie eine VLESS-Konfiguration ein",
                connectedSuccess: "Erfolgreich verbunden!",
                disconnectedSuccess: "Getrennt"
            },
            tr: {
                subtitle: "Güvenli Bağlantı için VPN'iniz",
                configLabel: "VLESS Yapılandırmanız",
                configPlaceholder: "vless://...",
                connectBtn: "Bağlan",
                disconnectBtn: "Bağlantıyı Kes",
                connecting: "Bağlanıyor...",
                statusLabel: "Durum:",
                serverLabel: "Sunucu:",
                portLabel: "Port:",
                footer: "© 2024 NetBoxy - Herkes için güvenli bağlantı",
                connected: "Bağlandı",
                disconnected: "Bağlı Değil",
                invalidConfig: "Geçersiz yapılandırma! Lütfen VLESS bağlantınızı kontrol edin",
                emptyConfig: "Lütfen bir VLESS yapılandırması girin",
                connectedSuccess: "Başarıyla bağlandı!",
                disconnectedSuccess: "Bağlantı kesildi"
            }
        };

        let currentLang = 'ar';
        let isConnected = false;
        let parsedConfig = null;

        // Check if running in Android WebView
        const isAndroid = typeof Android !== 'undefined';

        function changeLanguage(lang) {
            currentLang = lang;
            const html = document.documentElement;
            
            if (lang === 'ar') {
                html.setAttribute('dir', 'rtl');
                html.setAttribute('lang', 'ar');
            } else {
                html.setAttribute('dir', 'ltr');
                html.setAttribute('lang', lang);
            }

            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });

            const configInput = document.getElementById('vlessConfig');
            if (configInput) {
                configInput.placeholder = translations[lang].configPlaceholder;
            }

            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function parseVlessConfig(url) {
            try {
                if (!url.startsWith('vless://')) return null;

                const withoutProtocol = url.substring(8);
                const atIndex = withoutProtocol.indexOf('@');
                if (atIndex === -1) return null;
                
                const uuid = withoutProtocol.substring(0, atIndex);
                const rest = withoutProtocol.substring(atIndex + 1);
                
                const hashIndex = rest.indexOf('#');
                const configPart = hashIndex !== -1 ? rest.substring(0, hashIndex) : rest;
                const name = hashIndex !== -1 ? decodeURIComponent(rest.substring(hashIndex + 1)) : '';
                
                const questionIndex = configPart.indexOf('?');
                const serverPort = questionIndex !== -1 ? configPart.substring(0, questionIndex) : configPart;
                const paramsString = questionIndex !== -1 ? configPart.substring(questionIndex + 1) : '';
                
                const [server, port] = serverPort.split(':');
                const params = new URLSearchParams(paramsString);
                
                return {
                    uuid: uuid,
                    server: server,
                    port: port,
                    encryption: params.get('encryption') || 'none',
                    security: params.get('security') || 'none',
                    sni: params.get('sni') || '',
                    type: params.get('type') || 'tcp',
                    host: params.get('host') || '',
                    path: params.get('path') || '/',
                    name: name
                };
            } catch (e) {
                return null;
            }
        }

        function displayConfigDetails(config) {
            const detailsDiv = document.getElementById('configDetails');
            
            const details = [
                { label: 'UUID', value: config.uuid },
                { label: 'Server', value: config.server },
                { label: 'Port', value: config.port },
                { label: 'Encryption', value: config.encryption },
                { label: 'Security', value: config.security },
                { label: 'SNI', value: config.sni },
                { label: 'Type', value: config.type },
                { label: 'Host', value: config.host },
                { label: 'Path', value: config.path },
                { label: 'Name', value: config.name }
            ];

            let html = '';
            details.forEach(item => {
                if (item.value) {
                    html += `
                        <div class="detail-item">
                            <div class="detail-label">${item.label}</div>
                            <div class="detail-value">${item.value}</div>
                        </div>
                    `;
                }
            });

            detailsDiv.innerHTML = html;
            detailsDiv.classList.add('show');
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            const successDiv = document.getElementById('successMessage');
            successDiv.classList.remove('show');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
            
            setTimeout(() => {
                errorDiv.classList.remove('show');
            }, 5000);
        }

        function showSuccess(message) {
            const errorDiv = document.getElementById('errorMessage');
            const successDiv = document.getElementById('successMessage');
            errorDiv.classList.remove('show');
            successDiv.textContent = message;
            successDiv.classList.add('show');
            
            setTimeout(() => {
                successDiv.classList.remove('show');
            }, 3000);
        }

        function updateStatus(status, server = '-', port = '-') {
            document.getElementById('statusValue').textContent = status;
            document.getElementById('serverValue').textContent = server;
            document.getElementById('portValue').textContent = port;
            document.getElementById('statusContainer').classList.add('show');
        }

        // Callback from Android
        window.onVpnStatusChange = function(status, message) {
            const connectBtn = document.getElementById('connectBtn');
            const btnText = connectBtn.querySelector('[data-i18n]');

            if (status === 'connected') {
                isConnected = true;
                connectBtn.classList.remove('connecting');
                connectBtn.classList.add('connected');
                btnText.textContent = translations[currentLang].disconnectBtn;
                updateStatus(
                    translations[currentLang].connected,
                    parsedConfig.server,
                    parsedConfig.port
                );
                showSuccess(translations[currentLang].connectedSuccess);
            } else if (status === 'disconnected') {
                isConnected = false;
                connectBtn.classList.remove('connected', 'connecting');
                btnText.textContent = translations[currentLang].connectBtn;
                updateStatus(translations[currentLang].disconnected);
                document.getElementById('configDetails').classList.remove('show');
                showSuccess(translations[currentLang].disconnectedSuccess);
            } else if (status === 'error') {
                isConnected = false;
                connectBtn.classList.remove('connecting', 'connected');
                btnText.textContent = translations[currentLang].connectBtn;
                showError(message);
            }
        };

        async function toggleConnection() {
            const configInput = document.getElementById('vlessConfig');
            const connectBtn = document.getElementById('connectBtn');
            const btnText = connectBtn.querySelector('[data-i18n]');

            if (isConnected) {
                // Disconnect
                if (isAndroid) {
                    Android.disconnect();
                } else {
                    // Fallback for web browser testing
                    isConnected = false;
                    connectBtn.classList.remove('connected');
                    btnText.textContent = translations[currentLang].connectBtn;
                    updateStatus(translations[currentLang].disconnected);
                    document.getElementById('configDetails').classList.remove('show');
                    showSuccess(translations[currentLang].disconnectedSuccess);
                }
                return;
            }

            // Connect
            const configUrl = configInput.value.trim();
            
            if (!configUrl) {
                showError(translations[currentLang].emptyConfig);
                return;
            }

            parsedConfig = parseVlessConfig(configUrl);
            
            if (!parsedConfig) {
                showError(translations[currentLang].invalidConfig);
                return;
            }

            // Show connecting state
            connectBtn.classList.add('connecting');
            btnText.innerHTML = translations[currentLang].connecting + ' <span class="loading-spinner"></span>';

            // Display config details
            displayConfigDetails(parsedConfig);

            if (isAndroid) {
                // Call Android native method
                Android.connect(JSON.stringify(parsedConfig));
            } else {
                // Fallback for web browser testing
                setTimeout(() => {
                    isConnected = true;
                    connectBtn.classList.remove('connecting');
                    connectBtn.classList.add('connected');
                    btnText.textContent = translations[currentLang].disconnectBtn;
                    updateStatus(
                        translations[currentLang].connected,
                        parsedConfig.server,
                        parsedConfig.port
                    );
                    showSuccess(translations[currentLang].connectedSuccess);
                }, 2000);
            }
        }

        // Load saved config
        window.addEventListener('load', () => {
            const savedConfig = localStorage.getItem('vlessConfig');
            if (savedConfig) {
                document.getElementById('vlessConfig').value = savedConfig;
            }
        });

        // Save config on change
        document.getElementById('vlessConfig').addEventListener('change', (e) => {
            localStorage.setItem('vlessConfig', e.target.value);
        });
    </script>
</body>
</html>